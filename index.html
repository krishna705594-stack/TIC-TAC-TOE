<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tic Tac Toe Online</title>
  <style>
    body {
      font-family: 'Press Start 2P', cursive;
      text-align: center;
      background: #f3f3f3;
    }

    h1 {
      margin-top: 40px;
    }

    .board {
      display: grid;
      grid-template-columns: repeat(3, 100px);
      grid-template-rows: repeat(3, 100px);
      gap: 10px;
      justify-content: center;
      margin-top: 30px;
    }

    .cell {
      background: white;
      border: 2px solid black;
      font-size: 36px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
    }

    button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }

    #status {
      margin-top: 15px;
      font-size: 14px;
      color: gray;
    }

    /* üèÜ Win Screen */
    #winOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      color: white;
      z-index: 100;
    }

    #winOverlay h2 {
      font-size: 24px;
      margin-bottom: 20px;
      text-shadow: 2px 2px 4px #000;
    }

    #winOverlay button {
      background: #ff4081;
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }

    #winOverlay button:hover {
      background: #ff5c9a;
    }
  </style>
</head>
<body>
  <h1>TIC-TAC-TOE</h1>
  <p>JUST FOR PLAYING WITH MY FRIENDS...</p>

  <!-- üîπ Room Controls -->
  <div style="text-align:center; margin-bottom:20px;">
    <input type="text" id="playerName" placeholder="Enter Your Name">
    <input type="text" id="roomCode" placeholder="Enter Room Code">
    <button id="createRoom">Create Room</button>
    <button id="joinRoom">Join Room</button>
    <p id="status">Waiting for action...</p>
  </div>

  <!-- üîπ Game Board -->
  <div class="board" id="board"></div>
  <button id="resetButton">Reset Game</button>

  <!-- üèÜ Win Overlay -->
  <div id="winOverlay">
    <h2 id="winMessage"></h2>
    <button id="playAgainBtn">Reset Game</button>
  </div>

  <!-- üîπ Firebase + Game Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, set, get, onValue, update } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB2wrRxkm8NlDcoa9_6q6a3PjyWXMrsIOk",
      authDomain: "tic-tac-toe-online-24631.firebaseapp.com",
      projectId: "tic-tac-toe-online-24631",
      storageBucket: "tic-tac-toe-online-24631.firebasestorage.app",
      messagingSenderId: "812537114665",
      appId: "1:812537114665:web:b8eec1edebc355cfa9ec38",
      databaseURL: "https://tic-tac-toe-online-24631-default-rtdb.firebaseio.com/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const boardElement = document.getElementById("board");
    const status = document.getElementById("status");
    const roomInput = document.getElementById("roomCode");
    const playerInput = document.getElementById("playerName");
    const createRoomBtn = document.getElementById("createRoom");
    const joinRoomBtn = document.getElementById("joinRoom");
    const resetBtn = document.getElementById("resetButton");
    const winOverlay = document.getElementById("winOverlay");
    const winMessage = document.getElementById("winMessage");
    const playAgainBtn = document.getElementById("playAgainBtn");

    let roomCode = "";
    let currentPlayer = "X";
    let mySymbol = "";
    let board = ["", "", "", "", "", "", "", "", ""];
    let playerName = "";

    // Create cells
    for (let i = 0; i < 9; i++) {
      const cell = document.createElement("div");
      cell.classList.add("cell");
      cell.addEventListener("click", () => makeMove(i));
      boardElement.appendChild(cell);
    }

    // Create room
    createRoomBtn.onclick = async () => {
      playerName = playerInput.value.trim() || "Player X";
      roomCode = Math.random().toString(36).substring(2, 7).toUpperCase();
      mySymbol = "X";
      await set(ref(db, "rooms/" + roomCode), {
        board: board,
        currentPlayer: "X",
        players: { X: playerName }
      });
      status.textContent = `Room Created: ${roomCode}. Waiting for player O...`;
      listenRoom();
    };

    // Join room
    joinRoomBtn.onclick = async () => {
      playerName = playerInput.value.trim() || "Player O";
      roomCode = roomInput.value.trim().toUpperCase();
      if (!roomCode) return alert("Enter a room code!");
      const snapshot = await get(ref(db, "rooms/" + roomCode));
      if (!snapshot.exists()) return alert("Room not found!");
      mySymbol = "O";
      const data = snapshot.val();
      await update(ref(db, "rooms/" + roomCode + "/players"), { O: playerName });
      status.textContent = `Joined room ${roomCode}. You are O.`;
      listenRoom();
    };

    // Listen room changes
    function listenRoom() {
      onValue(ref(db, "rooms/" + roomCode), (snapshot) => {
        const data = snapshot.val();
        if (!data) return;
        board = data.board;
        currentPlayer = data.currentPlayer;
        updateBoardUI();

        const winner = checkWinner();
        if (winner && data.players) {
          const winnerName = data.players[winner] || `Player ${winner}`;
          showWinner(winnerName);
        }
      });
    }

    // Make a move
    async function makeMove(i) {
      if (board[i] || currentPlayer !== mySymbol) return;
      board[i] = mySymbol;
      currentPlayer = mySymbol === "X" ? "O" : "X";

      await set(ref(db, "rooms/" + roomCode), {
        board: board,
        currentPlayer: currentPlayer,
      });
    }

    function updateBoardUI() {
      const cells = document.querySelectorAll(".cell");
      board.forEach((val, i) => {
        cells[i].textContent = val;
      });
      status.textContent = `Room: ${roomCode} | Turn: ${currentPlayer}`;
    }

    // üèÜ Check Winner
    function checkWinner() {
      const winPatterns = [
        [0, 1, 2],
        [3, 4, 5],
        [6, 7, 8],
        [0, 3, 6],
        [1, 4, 7],
        [2, 5, 8],
        [0, 4, 8],
        [2, 4, 6],
      ];
      for (let pattern of winPatterns) {
        const [a, b, c] = pattern;
        if (board[a] && board[a] === board[b] && board[a] === board[c]) {
          return board[a];
        }
      }
      return null;
    }

    // üèÖ Show Winner
    function showWinner(name) {
      winMessage.textContent = `üéâ ${name} Wins! üéâ`;
      winOverlay.style.display = "flex";
    }

    // üîÅ Reset Button
    playAgainBtn.onclick = async () => {
      winOverlay.style.display = "none";
      if (!roomCode) return;
      board = ["", "", "", "", "", "", "", "", ""];
      await set(ref(db, "rooms/" + roomCode), {
        board: board,
        currentPlayer: "X",
      });
    };

    resetBtn.onclick = playAgainBtn.onclick;
  </script>
</body>
</html>
